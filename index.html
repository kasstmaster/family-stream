<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RDMN+</title>

  <!-- Google Fonts for Netflix-like styling -->
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">

<style>
  body {
  font-family: Arial, sans-serif;
  background: #141414;
  color: #fff;
  margin: 0;
  font-size: 22px; /* Base font size for all text */
}

/* HEADER */
header {
  background: #000;
  width: 100%;
  padding: 25px 0;
  text-align: center;
  position: relative;
}
header img {
  max-width: 450px; /* Larger logo */
  height: auto;
}

/* LOGOUT BUTTON */
.logout-btn {
  position: absolute;
  right: 20px;
  padding: 18px 36px; /* Bigger padding */
  font-size: 26px; /* Bigger text */
  background: #e50914;
  color: #fff;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
}
.logout-btn:hover {
  background: #f6121d;
}

/* SEARCH BAR */
.search-bar {
  text-align: center;
  padding: 30px;
}
.search-bar input {
  padding: 26px 24px; /* Taller input */
  width: 95%;
  max-width: 750px;   /* Wider */
  font-size: 28px;    /* Bigger text */
  border-radius: 12px;
  border: none;
}

/* SECTION TITLE */
#sectionTitle {
  text-align: center;
  font-size: 70px;
  font-weight: bold;
  margin-top: 25px;
  font-family: 'Bebas Neue', sans-serif;
  letter-spacing: 3px;
}

/* GRID */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 30px;
  padding: 35px;
}

/* MOVIE CARDS */
.movie-card {
  background: #1f1f1f;
  border-radius: 12px;
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.3s ease;
  position: relative;
  flex: 0 0 auto;
  width: 250px;
}
.movie-card:hover {
  transform: scale(1.08);
}
.movie-card img {
  width: 100%;
  height: 360px; /* Bigger posters */
  object-fit: cover;
  display: block;
}
.movie-title {
  padding: 14px;
  text-align: center;
  font-size: 26px; /* Bigger text */
  font-weight: bold;
}

/* BUTTONS (Global) */
button {
  font-size: 26px;
  padding: 18px 36px;
  border-radius: 10px;
  cursor: pointer;
}
.back-btn {
  display: none;
  margin: 20px 30px;
  background: #e50914;
  color: #fff;
  border: none;
}
.next-btn {
  display: none;
  margin-top: 25px;
  background: #e50914;
  color: #fff;
  border: none;
  font-size: 26px;
  border-radius: 10px;
}
.next-btn:hover {
  background: #f6121d;
}

/* MODAL */
.modal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.9);
  justify-content: center;
  align-items: center;
  z-index: 1000;
  flex-direction: column;
}
.modal.active {
  display: flex;
}
.modal-content {
  background: #1f1f1f;
  padding: 25px;
  border-radius: 14px;
  max-width: 95%;
  width: 1200px;
  position: relative;
}
.close-btn {
  position: absolute;
  top: 20px;
  right: 25px;
  font-size: 40px;
  cursor: pointer;
  color: #fff;
}
iframe {
  width: 100%;
  height: 800px;
  border: none;
  border-radius: 12px;
}
.movie-details {
  margin-top: 20px;
  font-size: 24px;
  color: #ccc;
}

/* SECTION TITLES */
.section-title {
  font-size: 44px;
  margin-left: 30px;
  font-family: 'Bebas Neue', sans-serif;
}

/* SCROLL CONTAINERS */
.scroll-container {
  display: flex;
  gap: 25px;
  padding: 30px;
  overflow-x: auto;
  scroll-behavior: smooth;
}
.scroll-container::-webkit-scrollbar {
  display: none;
}

/* SCROLL BUTTONS */
.row-wrapper {
  position: relative;
  display: flex;
  align-items: center;
}
.scroll-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0, 0, 0, 0.7);
  color: white;
  font-size: 50px;
  border: none;
  cursor: pointer;
  padding: 22px;
  z-index: 10;
  border-radius: 50%;
}
.scroll-btn.left {
  left: 15px;
}
.scroll-btn.right {
  right: 15px;
}
.scroll-btn:hover {
  background: rgba(0, 0, 0, 0.9);
}
</style>
</head>
<body>
  <div id="loginScreen" style="display:flex;justify-content:center;align-items:center;height:100vh;background:#141414;color:white;flex-direction:column;">
    <h2 style="font-family:'Bebas Neue',sans-serif;font-size:32px;">Enter Password</h2>
    <input type="password" id="passwordInput" placeholder="Password" style="padding:10px;font-size:16px;border-radius:5px;border:none;margin-top:10px;">
    <button onclick="checkPassword()" style="margin-top:10px;padding:10px 20px;font-size:18px;background:#e50914;color:white;border:none;border-radius:5px;cursor:pointer;">Login</button>
    <p id="errorMsg" style="color:#e50914;margin-top:10px;display:none;">Incorrect password</p>
  </div>
  <div id="appContent" style="display:none;">
  
<header style="background:#000;width:100%;">
  <div style="display:flex;justify-content:center;align-items:center;position:relative;height:80px;">
    <!-- Logo -->
    <img src="https://i.postimg.cc/jjFhf2Mc/RDMN.png" alt="RDMN+ Logo" style="max-width:300px;height:auto;" />
    
    <!-- Logout Button -->
    <button onclick="logout()" class="logout-btn">
      Logout
    </button>
  </div>
</header>
  
  <!-- Search Bar -->
  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="Search movies or shows..." />
  </div>

  <!-- Section Title -->
  <div id="sectionTitle"></div>

  <!-- Back Button -->
  <button class="back-btn" id="backBtn">⬅ Back</button>

  <!-- Continue Watching Grid -->
  <div id="continueSection" style="display:none;">
    <h2 class="section-title">Continue Watching</h2>
    <div class="scroll-container" id="continueRow"></div>
  </div>

  <!-- Movie Grid -->
  <div id="moviesSection">
  <h2 class="section-title">Movies</h2>
  <div class="row-wrapper">
      <button class="scroll-btn left" onclick="scrollRow('moviesRow', -1)">&#10094;</button>
      <div class="scroll-container" id="moviesRow"></div>
      <button class="scroll-btn right" onclick="scrollRow('moviesRow', 1)">&#10095;</button>
    </div>
  </div>
  <!-- TV Grid -->
  <div id="tvSection">
    <h2 class="section-title">TV Shows</h2>
    <div class="row-wrapper">
      <button class="scroll-btn left" onclick="scrollRow('tvRow', -1)">&#10094;</button>
      <div class="scroll-container" id="tvRow"></div>
      <button class="scroll-btn right" onclick="scrollRow('tvRow', 1)">&#10095;</button>
    </div>
  </div>

  <!-- Episodes Grid -->
  <div id="episodesSection" style="display:none; padding:20px;">
    <h2 class="section-title" id="episodesTitle"></h2>
    <div class="grid" id="episodesGrid"></div>
  </div>

  <!-- Netflix Grid -->
  <div id="netflixSection">
    <h2 class="section-title">Currently on Netflix</h2>
    <div class="row-wrapper">
      <button class="scroll-btn left" onclick="scrollRow('netflixRow', -1)">&#10094;</button>
      <div class="scroll-container" id="netflixRow"></div>
      <button class="scroll-btn right" onclick="scrollRow('netflixRow', 1)">&#10095;</button>
    </div>
  </div>

  <!-- Search Results Section -->
  <div id="searchResultsSection" style="display:none;">
    <h2 class="section-title">Search Results</h2>
    <div class="grid" id="searchResultsGrid"></div>
  </div>

  <!-- Modal -->
  <div class="modal" id="videoModal">
    <span class="close-btn" id="closeBtn">&times;</span>
    <div class="modal-content">
      <iframe id="videoFrame" allow="fullscreen"></iframe>
      <div class="movie-details" id="movieDetails"></div>
    </div>
    <button class="next-btn" id="nextBtn">Next Episode ➡</button>
  </div>
</div>
<script>
window.onload = () => {
  if (localStorage.getItem("loggedIn") === "true") {
    showApp();
  }
};

const API_URL = "https://script.google.com/macros/s/AKfycbxWJoC3T9cQchL62dJNv3-A-xSu0lHmmKe4091wR9MkifkfoTw074s5JG3vME_XwZ9mhg/exec";

const movieGrid = document.getElementById("movieGrid");
const modal = document.getElementById("videoModal");
const closeBtn = document.getElementById("closeBtn");
const detailsDiv = document.getElementById("movieDetails");
const videoFrame = document.getElementById("videoFrame");
const backBtn = document.getElementById("backBtn");
const nextBtn = document.getElementById("nextBtn");
const sectionTitle = document.getElementById("sectionTitle");
const searchInput = document.getElementById("searchInput");

let currentView = "main";
let currentEpisodes = [];
let currentIndex = -1;
let currentShowTitle = "";
let fullLibrary = []; // ✅ Store all movies/TV here

async function loadLibrary() {
  const response = await fetch(API_URL);
  const data = await response.json();
  fullLibrary = [...data.movies, ...data.tv];

  shuffleArray(data.movies);
  shuffleArray(data.tv);

  renderMovies(data.movies);
  renderTV(data.tv);
  renderContinueWatching(); // ✅ Show Continue Watching row if there’s progress
}

function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function renderMovies(movies) {
  const moviesRow = document.getElementById("moviesRow");
  moviesRow.innerHTML = "";
  movies.forEach(item => {
    const card = createCard(item);
    moviesRow.appendChild(card);
  });
}

function renderTV(tvShows) {
  const tvRow = document.getElementById("tvRow");
  tvRow.innerHTML = "";
  tvShows.forEach(item => {
    const card = createCard(item);
    tvRow.appendChild(card);
  });
}

function createCard(item) {
  const card = document.createElement("div");
  card.classList.add("movie-card");
  card.innerHTML = `
    <img src="${item.poster}" alt="${item.title}" onerror="this.src='https://via.placeholder.com/300x450?text=${encodeURIComponent(item.title)}';">
    <div class="movie-title">${item.title}</div>
  `;
  card.addEventListener("click", () => {
    if (item.type === "movie") {
      openVideo(item.episodes[0].url, item.title, "", "", false);
    } else {
      showEpisodes(item);
    }
  });
  return card;
}

function showEpisodes(show) {
  // Hide Movies and TV sections
  document.getElementById("moviesSection").style.display = "none";
  document.getElementById("tvSection").style.display = "none";

  // Show Episodes section
  document.getElementById("episodesSection").style.display = "block";

  // Set the title
  document.getElementById("episodesTitle").textContent = show.title;

  // Fill episodes grid
  const episodesGrid = document.getElementById("episodesGrid");
  episodesGrid.innerHTML = "";

  show.episodes.forEach((ep, index) => {
    const card = document.createElement("div");
    card.classList.add("movie-card");
    card.innerHTML = `
      <img src="${show.poster}" alt="${ep.title}">
      <div class="movie-title">${ep.title}</div>
    `;
    card.addEventListener("click", () => {
      // Open the video directly in iframe
      videoFrame.src = ep.url;
      detailsDiv.innerHTML = `<strong>${show.title} - ${ep.title}</strong>`;
      modal.classList.add("active");
      currentIndex = index;
      currentEpisodes = show.episodes;
      currentShowTitle = show.title;
    });
    episodesGrid.appendChild(card);
  });

  // Show Back button to return to main layout
  backBtn.style.display = "inline-block";
}

function openVideo(url, title, year, description, isTV) {
  console.log("Opening video:", url);
  modal.classList.add("active");
  videoFrame.src = url;
  detailsDiv.innerHTML = `<strong>${title}</strong><br>${description || ""}`;
  nextBtn.style.display = isTV && currentIndex < currentEpisodes.length - 1 ? "block" : "none";

  if (isTV) {
    localStorage.setItem(`progress_${currentShowTitle}`, currentIndex);
  }
}

nextBtn.addEventListener("click", () => {
  if (currentIndex < currentEpisodes.length - 1) {
    currentIndex++;
    const ep = currentEpisodes[currentIndex];
    openVideo(ep.url, ep.title, "", "", true);
  }
});

closeBtn.addEventListener("click", () => {
  modal.classList.remove("active");
  videoFrame.src = "";
});

backBtn.addEventListener("click", () => {
  document.getElementById("episodesSection").style.display = "none";
  document.getElementById("moviesSection").style.display = "block";
  document.getElementById("tvSection").style.display = "block";
  backBtn.style.display = "none";
});

// ✅ Instant Search
searchInput.addEventListener("input", (e) => {
  const query = e.target.value.toLowerCase();

  if (query === "") {
    // ✅ Restore all sections when search is empty
    document.getElementById("moviesSection").style.display = "block";
    document.getElementById("tvSection").style.display = "block";
    document.getElementById("netflixSection").style.display = "block";
    document.getElementById("continueSection").style.display = "block";
    sectionTitle.textContent = "";
    document.getElementById("searchResultsSection").style.display = "none";
  } else {
    // ✅ Hide everything else
    document.getElementById("moviesSection").style.display = "none";
    document.getElementById("tvSection").style.display = "none";
    document.getElementById("netflixSection").style.display = "none";
    document.getElementById("continueSection").style.display = "none";

    // ✅ Show Search Results
    const filtered = fullLibrary.filter(item =>
      item.title.toLowerCase().includes(query)
    );
    sectionTitle.textContent = "Search Results";
    showSearchResults(filtered);
    document.getElementById("searchResultsSection").style.display = "block";
  }
});

function showSearchResults(list) {
  const container = document.getElementById("searchResultsGrid");
  container.innerHTML = "";
  list.forEach(item => {
    const card = createCard(item);
    container.appendChild(card);
  });
}

function scrollRow(rowId, direction) {
  const container = document.getElementById(rowId);
  const scrollAmount = container.offsetWidth; // Scroll by one row width
  container.scrollBy({
    left: scrollAmount * direction,
    behavior: "smooth"
  });
}

function renderContinueWatching() {
  const continueRow = document.getElementById("continueRow");
  continueRow.innerHTML = "";

  const keys = Object.keys(localStorage).filter(key => key.startsWith("progress_"));
  if (keys.length === 0) {
    document.getElementById("continueSection").style.display = "none";
    return;
  }

  // Find matching items in fullLibrary
  const items = [];
  keys.forEach(key => {
    const title = key.replace("progress_", "");
    const item = fullLibrary.find(i => i.title === title);
    if (item) items.push(item);
  });

  if (items.length > 0) {
    document.getElementById("continueSection").style.display = "block";
    items.forEach(item => {
      const card = createCard(item);
      continueRow.appendChild(card);
    });
  } else {
    document.getElementById("continueSection").style.display = "none";
  }
}

async function loadNetflixContent() {
  const API_KEY = "48f719a14913f9d4ee92c684c2187625"; // Replace with your TMDb key
  const netflixRow = document.getElementById("netflixRow");
  netflixRow.innerHTML = "";

  let allContent = [];

  // Fetch Netflix Movies (3 pages)
  for (let page = 1; page <= 3; page++) {
    const movieEndpoint = `https://api.themoviedb.org/3/discover/movie?with_watch_providers=8&watch_region=US&include_adult=false&language=en-US&sort_by=popularity.desc&page=${page}&api_key=${API_KEY}`;
    const movieResponse = await fetch(movieEndpoint);
    const movieData = await movieResponse.json();
    allContent = allContent.concat(movieData.results);
  }

  // Fetch Netflix TV Shows (3 pages)
  for (let page = 1; page <= 3; page++) {
    const tvEndpoint = `https://api.themoviedb.org/3/discover/tv?with_watch_providers=8&watch_region=US&include_adult=false&language=en-US&sort_by=popularity.desc&page=${page}&api_key=${API_KEY}`;
    const tvResponse = await fetch(tvEndpoint);
    const tvData = await tvResponse.json();
    allContent = allContent.concat(tvData.results);
  }

  // Shuffle combined list for variety
  shuffleArray(allContent);

  // Display combined Movies + TV
  allContent.forEach(item => {
    const card = document.createElement("div");
    card.classList.add("movie-card");
    const poster = item.poster_path
      ? `https://image.tmdb.org/t/p/w500${item.poster_path}`
      : "https://via.placeholder.com/300x450?text=No+Image";
    const title = item.title || item.name; // Movies use title, TV uses name
    card.innerHTML = `
      <img src="${poster}" alt="${title}">
      <div class="movie-title">${title}</div>
    `;
    netflixRow.appendChild(card);
  });
}

// Helper: Shuffle function
// ✅ Shuffle helper function
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

// ✅ App password (change this to your desired password)
const APP_PASSWORD = "YourSecretPassword";

function checkPassword() {
  const input = document.getElementById("passwordInput").value;
  if (input === APP_PASSWORD) {
    localStorage.setItem("loggedIn", "true"); // ✅ Save login state
    showApp();
  } else {
    document.getElementById("errorMsg").style.display = "block";
  }
}

function showApp() {
  document.getElementById("loginScreen").style.display = "none";
  document.getElementById("appContent").style.display = "block";
}
  
function logout() {
  localStorage.removeItem("loggedIn");
  document.getElementById("appContent").style.display = "none";
  document.getElementById("loginScreen").style.display = "flex";
}

loadNetflixContent();
loadLibrary();
</script>

</body>
</html>
